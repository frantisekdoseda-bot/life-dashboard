<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Life Dashboard</title>

<style>
body{
background:#0b0f14;
color:white;
font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
padding:16px;
margin:0;
}

.card{
background:#111723;
padding:18px;
border-radius:20px;
margin-bottom:16px;
box-shadow:0 10px 25px rgba(0,0,0,0.35);
}

.big{font-size:28px;font-weight:600;}
.small{opacity:.7;font-size:13px;margin-bottom:6px;}
.row{display:flex;justify-content:space-between;margin-top:6px;font-size:14px;}
.ok{color:#51cf66;}
.warn{color:#ff6b6b;}
iframe{border:none;width:100%;height:300px;border-radius:12px;}
</style>
</head>

<body>

<!-- POČASÍ -->
<div class="card">
<div class="small">POČASÍ</div>
<div class="big" id="temp">Načítám...</div>
<div id="weatherDetails"></div>
</div>

<!-- FINANCE -->
<div class="card">
<div class="small">TENTO TÝDEN</div>
<div class="big" id="spent">0 Kč</div>
<div class="row"><span>Limit</span><span>10 000 Kč</span></div>
<div class="row"><span>Zbývá</span><span id="left">10 000 Kč</span></div>
<div class="row"><span>Status</span><span id="status" class="ok">V pohodě</span></div>
</div>

<!-- GOOGLE KALENDÁŘ -->
<div class="card">
<div class="small">KALENDÁŘ</div>
<iframe src="https://calendar.google.com/calendar/embed?mode=AGENDA"></iframe>
</div>

<!-- JÍZDNÍ ŘÁDY -->
<div class="card">
<div class="small">NEJBLIŽŠÍ ZASTÁVKA (Praha)</div>
<div id="transport">Načítám...</div>
</div>

<script>
/* FINANCE */
let total = localStorage.getItem("spent") ? Number(localStorage.getItem("spent")) : 0;
const limit = 10000;

function renderFinance(){
document.getElementById("spent").innerText = total + " Kč";
let left = limit-total;
if(left<0) left=0;
document.getElementById("left").innerText = left + " Kč";
if(total>limit){
document.getElementById("status").innerText="Přes limit";
document.getElementById("status").className="warn";
}else{
document.getElementById("status").innerText="V pohodě";
document.getElementById("status").className="ok";
}
}
renderFinance();

/* POČASÍ */
navigator.geolocation.getCurrentPosition(pos=>{
let lat=pos.coords.latitude;
let lon=pos.coords.longitude;

fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=sunrise,sunset,uv_index_max&timezone=auto`)
.then(r=>r.json())
.then(data=>{
document.getElementById("temp").innerText=data.current_weather.temperature+"°C";

let sunrise=data.daily.sunrise[0].split("T")[1].slice(0,5);
let sunset=data.daily.sunset[0].split("T")[1].slice(0,5);
let uv=data.daily.uv_index_max[0];

document.getElementById("weatherDetails").innerHTML=
`
<div class="row"><span>UV index</span><span>${uv}</span></div>
<div class="row"><span>Východ</span><span>${sunrise}</span></div>
<div class="row"><span>Západ</span><span>${sunset}</span></div>
`;
});
});

/* JÍZDNÍ ŘÁDY – jednoduchá PID ukázka */
navigator.geolocation.getCurrentPosition(pos=>{
let lat=pos.coords.latitude;
let lon=pos.coords.longitude;

fetch(`https://api.golemio.cz/v2/gtfs/stops?lat=${lat}&lon=${lon}&limit=1`, {
headers: {"X-Access-Token":"public"}
})
.then(r=>r.json())
.then(data=>{
if(data.features && data.features.length>0){
document.getElementById("transport").innerText=
data.features[0].properties.stop_name;
}else{
document.getElementById("transport").innerText="Zastávka nenalezena";
}
})
.catch(()=>{
document.getElementById("transport").innerText="Nelze načíst PID";
});
});
</script>

</body>
</html>
