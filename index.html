<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Life Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
margin:0;
font-family:system-ui;
background:#0b1220;
color:white;
padding:20px;
}
.card{
background:#121a2e;
padding:20px;
border-radius:20px;
margin-bottom:20px;
}
button{
background:#4f46e5;
border:none;
padding:15px 25px;
border-radius:12px;
color:white;
font-size:18px;
}
.big{font-size:32px;font-weight:700}
.small{opacity:.7}
</style>
</head>

<body>

<div id="login" class="card">
<div class="big">Life dashboard</div>
<br>
<button onclick="login()">Přihlásit přes Google</button>
</div>

<div id="app" style="display:none">

<div class="card">
<div class="small">TENTO TÝDEN</div>
<div class="big" id="money">Načítám…</div>
</div>

<div class="card">
<div class="small">POČASÍ Praha</div>
<div class="big" id="weather">Načítám…</div>
</div>

<div class="card">
<div class="small">NEJBLIŽŠÍ TRAM</div>
<div class="big" id="tram">Načítám…</div>
</div>

<div class="card">
<div class="small">KALENDÁŘ</div>
<div id="calendar">Načítám…</div>
</div>

</div>

<script>
const { createClient } = window.supabase;

const supabaseClient = createClient(
  "https://khpjmtcewzavuxkbcgu.supabase.co",
  "sb_publishable_AXka4P4jst5XH6_ErP1LUQ_ZI9AIjGX"
);

async function login(){
  await supabaseClient.auth.signInWithOAuth({
    provider: 'google',
    options: {
      redirectTo: 'https://life-dashboard-9eoc.onrender.com'
    }
  });
}

supabaseClient.auth.getSession().then(({ data }) => {
  if (data.session) {
    startApp();
  }
});

function startApp(){
  document.getElementById("login").style.display="none";
  document.getElementById("app").style.display="block";

  loadWeather();
  loadTram();
  loadCalendar();
  loadMoney();

  setInterval(loadTram, 60000);       // každou minutu
  setInterval(loadWeather, 900000);   // každých 15 minut
}
</script>

</body>
</html>
