<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>

<style>
body{
background:#0b0f14;
color:#e5e7eb;
font-family:system-ui;
margin:0;
padding:18px;
}
.card{
background:#111827;
border-radius:18px;
padding:18px;
margin-bottom:16px;
box-shadow:0 0 20px rgba(0,0,0,.4);
}
.title{
opacity:.6;
font-size:13px;
margin-bottom:6px;
}
.big{
font-size:34px;
font-weight:700;
}
.row{
display:flex;
justify-content:space-between;
margin-top:6px;
font-size:15px;
}
hr{
border:none;
border-top:1px solid #222;
margin:10px 0;
}
</style>
</head>

<body>

<div class="card">
<div class="title">POÄŒASÃ</div>
<div class="big" id="temp">NaÄÃ­tÃ¡mâ€¦</div>
<div id="desc"></div>
<div class="row"><span>UV</span><span id="uv">-</span></div>
<div class="row"><span>DÃ©Å¡Å¥</span><span id="rain">-</span></div>
<div class="row"><span>MÄ›sÃ­c</span><span id="moon">-</span></div>
<hr>
<div class="row"><span>VÃ½chod</span><span id="sunrise">-</span></div>
<div class="row"><span>ZÃ¡pad</span><span id="sunset">-</span></div>
</div>

<div class="card">
<div class="title">VELETRÅ½NÃ PALÃC</div>
<div id="veletrzni">NaÄÃ­tÃ¡mâ€¦</div>
</div>

<div class="card">
<div class="title">STROSSMAYEROVO NÃM</div>
<div id="stross">NaÄÃ­tÃ¡mâ€¦</div>
</div>

<script>

// ---------- POÄŒASÃ ----------
async function loadWeather(lat,lon){
let url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=sunrise,sunset,uv_index_max,precipitation_sum&timezone=auto`;

let r=await fetch(url);
let j=await r.json();

document.getElementById("temp").innerText=j.current_weather.temperature+"Â°C";
document.getElementById("uv").innerText=j.daily.uv_index_max[0];
document.getElementById("rain").innerText=j.daily.precipitation_sum[0]+" mm";
document.getElementById("sunrise").innerText=j.daily.sunrise[0].split("T")[1].slice(0,5);
document.getElementById("sunset").innerText=j.daily.sunset[0].split("T")[1].slice(0,5);

// fÃ¡ze mÄ›sÃ­ce
let moon=Math.floor((Date.now()/1000/86400)%29.53);
let phase="ğŸŒ‘";
if(moon<7) phase="ğŸŒ’";
else if(moon<15) phase="ğŸŒ•";
else if(moon<22) phase="ğŸŒ–";
else phase="ğŸŒ˜";
document.getElementById("moon").innerText=phase;
}

// ---------- MHD ----------
async function loadStop(name,el){
try{
let r=await fetch(`https://api.golemio.cz/v2/pid/departureboards?names[]=${encodeURIComponent(name)}&limit=5`,{
headers:{"x-access-token":"public-demo"}
});
let j=await r.json();

let html="";
j.departures.slice(0,5).forEach(d=>{
let t=d.departure_timestamp.predicted.substring(11,16);
html+=`<div class="row"><b>${d.route.short_name}</b><span>${d.trip.headsign} â€¢ ${t}</span></div>`;
});
document.getElementById(el).innerHTML=html;

}catch{
document.getElementById(el).innerText="nelze naÄÃ­st";
}
}

function loadMHD(){
loadStop("VeletrÅ¾nÃ­ palÃ¡c","veletrzni");
loadStop("Strossmayerovo nÃ¡mÄ›stÃ­","stross");
}

// ---------- GEO ----------
navigator.geolocation.getCurrentPosition(pos=>{
let lat=pos.coords.latitude;
let lon=pos.coords.longitude;
loadWeather(lat,lon);
});

// refresh
loadMHD();
setInterval(loadMHD,60000);
setInterval(()=>{
navigator.geolocation.getCurrentPosition(pos=>{
loadWeather(pos.coords.latitude,pos.coords.longitude);
});
},900000);

</script>

</body>
</html>
